syntax = "proto3";

package proto;

option go_package = "www.velocidex.com/golang/velociraptor/api/proto";

message SecretDefinition {
    string type_name = 1;
    string verifier = 2;
    string description = 5;

    // The fields that are supported by the secret. These are in a
    // list to ensure consistent ordering.
    repeated string fields = 7;

    map<string, string> template = 4;
    repeated string secret_names = 3;

    // deprecated - all secrets must be built in, no custom templates
    // can be defined.
    bool built_in = 6;
}

message SecretDefinitionList {
    repeated SecretDefinition items = 1;
}

message Secret {
    string name = 1;
    string type_name = 2;
    string description = 5;

    // The secret is stored as an encrypted json blob in storage. The
    // blob is encrypted with the DEK derived from
    // config_obj.Security.secrets_dek
    bytes encrypted_secret = 6;

    map<string, string> secret = 3;

    repeated string users = 4;

    // A list of orgs which can see the secret. Only meaningful for
    // secrets at the root org.
    repeated string orgs = 7;

    // When true this secret is available to all orgs automatically.
    bool visible_to_all_orgs = 8;
}

message ModifySecretRequest {
    string type_name = 1;
    string name = 2;

    // If set the secret will be deleted.
    bool delete = 3;
    repeated string add_users = 4;
    repeated string remove_users = 5;

    // Update the secret's org visibility list. Only meaningful for
    // secrets at the root org.
    repeated string add_orgs = 6;
    repeated string remove_orgs = 7;

    // When true this secret is available to all orgs automatically.
    bool visible_to_all_orgs = 8;
}
