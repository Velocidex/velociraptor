Parameters:
  ReadRegMock: |
    [{
        "Key": {
          "OSPath": {"DelegateAccessor": "file","DelegatePath": "/C:/Windows/appcompat/Programs/Amcache.hve","Path":"/Root/InventoryDevicePnp/\"pci/ven_8086\\u0026dev_10d3\\u0026subsys_07d015ad\\u0026rev_00/000c29ffff23301200\"", "Components": ["Root", "InventoryDevidePnp"]},
          "Size": 0,
          "Mode": 2147484141,
          "ModeStr": "drwxr-xr-x",
          "ModTime": "2021-04-09T21:47:09Z",
          "Sys": null,
          "Mtime": "2021-04-09T21:47:09Z",
          "Ctime": "2021-04-09T21:47:09Z",
          "Atime": "2021-04-09T21:47:09Z"
        },
        "Model": "Intel(R) 82574L Gigabit Network Connection",
        "Manufacturer": "Intel Corporation",
        "DriverName": "e1i65x64.sys",
        "ParentId": "pci\\ven_15ad&dev_07a0&subsys_07a015ad&rev_01\\3&18d45aa6&0&a8",
        "MatchingID": "pci\\ven_8086&dev_10d3",
        "Class": "net",
        "ClassGuid": "{4d36e972-e325-11ce-bfc1-08002be10318}",
        "Description": "Intel(R) 82574L Gigabit Network Connection",
        "Enumerator": "pci",
        "Service": "e1i65x64",
        "InstallState": "0",
        "DeviceState": "32",
        "Inf": "net1ic64.inf",
        "DriverVerDate": 6,
        "InstallDate": 1,
        "FirstInstallDate": 1,
        "DriverPackageStrongName": "net1ic64.inf_amd64_5f033e913d34d111",
        "DriverVerVersion": "12.17.10.8",
        "ContainerId": "{1fe39919-d4cc-915c-c431-581af43bd7d9}",
        "ProblemCode": "0",
        "Provider": "Microsoft",
        "DriverId": "000022a9b6e2023b86e51419c8a43ce567b28093c037",
        "BusReportedDescription": "Ethernet Controller",
        "HWID": "pci\\ven_8086&dev_10d3&subsys_07d015ad&rev_00,pci\\ven_8086&dev_10d3&subsys_07d015ad,pci\\ven_8086&dev_10d3&cc_020000,pci\\ven_8086&dev_10d3&cc_0200",
        "ExtendedInfs": "",
        "COMPID": "pci\\ven_8086&dev_10d3&rev_00,pci\\ven_8086&dev_10d3,pci\\ven_8086&cc_020000,pci\\ven_8086&cc_0200,pci\\ven_8086,pci\\cc_020000&dt_0,pci\\cc_020000,pci\\cc_0200&dt_0,pci\\cc_0200",
        "STACKID": "\\driver\\e1i65x64,\\driver\\acpi,\\driver\\pci",
        "UpperClassFilters": "",
        "LowerClassFilters": "",
        "UpperFilters": "",
        "LowerFilters": "",
        "DeviceInterfaceClasses": ""
      },
      {
        "Key": {
          "OSPath": {"DelegateAccessor":"file","DelegatePath":"/C:/Windows/appcompat/Programs/Amcache.hve","Path":"/Root/InventoryApplicationFile/7z.exe|1e434041bd08abf9", "Components": ["Root", "InventoryApplicationFile"]},
          "Size": 0,
          "Mode": 2147484141,
          "ModeStr": "drwxr-xr-x",
          "ModTime": "2021-01-26T00:44:14Z",
          "Sys": null,
          "Mtime": "2021-01-26T00:44:14Z",
          "Ctime": "2021-01-26T00:44:14Z",
          "Atime": "2021-01-26T00:44:14Z"
        },
        "ProgramId": "00067b31013cb72675f1a817efcfb27ba23900000904",
        "FileId": "000012345678d435163ae3945cbef30ef6b9872a4591",
        "LowerCaseLongPath": "c:\\programdata\\7-zip\\bin\\x64\\7z.exe",
        "LongPathHash": "7z.exe|1e434041bd08abf9",
        "Name": "7z.exe",
        "OriginalFileName": "7z.exe",
        "Publisher": "igor pavlov",
        "Version": "19.00",
        "BinFileVersion": "19.0.0.0",
        "BinaryType": "pe64_amd64",
        "ProductName": "7-zip",
        "ProductVersion": "19.00",
        "LinkDate": "02/21/2019 16:00:00",
        "BinProductVersion": "19.0.0.0",
        "AppxPackageFullName": "",
        "AppxPackageRelativeId": "",
        "Size": 468992,
        "Language": 1033,
        "Usn": 106933632
      },
      {
        "Key": {
          "OSPath":  {"DelegateAccessor":"file","DelegatePath":"/C:/Windows/appcompat/Programs/Amcache.hve","Path": "/Root/InventoryApplicationFile/1.exe|e7ecb4ace0d41711", "Components": ["Root", "InventoryApplicationFile"]},
          "Size": 0,
          "Mode": 2147484141,
          "ModeStr": "drwxr-xr-x",
          "ModTime": "2021-03-30T21:26:02Z",
          "Sys": null,
          "Mtime": "2021-03-30T21:26:02Z",
          "Ctime": "2021-03-30T21:26:02Z",
          "Atime": "2021-03-30T21:26:02Z"
        },
        "ProgramId": "000692269d6891c785cd9c35a6fa1ed61a8a0000ffff",
        "FileId": "000012345678611028f3328f52f1f136907d9cb6a701",
        "LowerCaseLongPath": "C:\\Users\\Public\\1.exe",
        "LongPathHash": "1.exe|e7ecb4ace0d41711",
        "Name": "1.exe",
        "OriginalFileName": "",
        "Publisher": "",
        "Version": "",
        "BinFileVersion": "",
        "BinaryType": "pe64_amd64",
        "ProductName": "",
        "ProductVersion": "",
        "LinkDate": "03/21/2021 14:06:42",
        "BinProductVersion": "",
        "AppxPackageFullName": "",
        "AppxPackageRelativeId": "",
        "Size": 45657088,
        "Language": 0,
        "Usn": 420745216
      },
      {
        "15": "C:\\Users\\Public\\a.exe",
        "16": 1,
        "17": 132593741561422880,
        "101": "00001234567890abcdef00001234567890abcdefffff",
        "Key": {
          "OSPath": {"DelegateAccessor":"file","DelegatePath":"/C:/Windows/AppCompat/Programs/Amcache.hve","Path": "/Root/File/3d4ad068-875c-4d05-915d-80dbc131d854/4800002f315", "Components": ["Root", "File"]},
          "Size": 0,
          "Mode": 2147484141,
          "ModeStr": "drwxr-xr-x",
          "ModTime": "2021-03-18T23:03:12Z",
          "Sys": null,
          "Mtime": "2021-03-18T23:03:12Z",
          "Ctime": "2021-03-18T23:03:12Z",
          "Atime": "2021-03-18T23:03:12Z"
        }
    }]

Queries:
  # Mock out the info plugin just for fun.
  - LET X <= SELECT mock(plugin='info', results=[dict(OS='windows', foo='bar'), dict(OS='windows', foo='baz')] ),
      mock(plugin='glob', results=[dict(OSPath='C:\\Windows\\AppCompat\\Programs\\Amcache.hve')] ),
      mock(plugin='read_reg_key', results=parse_json_array(data=ReadRegMock))
      FROM scope()

  # This artifact uses the raw registry parser.
  - SELECT * FROM Artifact.Windows.Detection.Amcache(SHA1Regex = '1234567890abcdef00001234567890abcdefffff')
  - SELECT * FROM Artifact.Windows.Detection.Amcache(PathRegex = 'C:\\\\Users\\\\Public\\\\')
  - SELECT * FROM Artifact.Windows.Detection.Amcache(NameRegex = '^a\\.exe$')
  - SELECT * FROM Artifact.Windows.Detection.Amcache()
