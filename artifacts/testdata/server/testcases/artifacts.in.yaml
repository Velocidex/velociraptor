Parameters:
  CLIENT_ID: "C.4f5e52adf0a337a9"

Queries:
  # Check the extension on file_store()
  - SELECT *, basename(path=file_store(path=vfs_path))
    FROM uploads(client_id=CLIENT_ID,
                 flow_id='F.BN2HJCPOF5U7U')

  # Schedule an artifact collection
  - SELECT collect_client(
        client_id=CLIENT_ID,
        artifacts='Windows.Search.FileFinder',
        env=dict(SearchFilesGlobTable ='Glob\nC:/*.txt\n')).request AS Flow
    FROM scope()

  # Schedule using a new style spec decleration.
  - SELECT collect_client(
        client_id=CLIENT_ID,
        artifacts='Windows.Search.FileFinder',
        spec=dict(`Windows.Search.FileFinder`=dict(
            SearchFilesGlobTable ='Glob\nC:/*.txt\n'))).request AS Flow
    FROM scope()


  # Check that artifact_definitions work
  - SELECT name FROM artifact_definitions(deps=TRUE, names='Windows.Search.FileFinder') ORDER BY name

  # Make sure we can return all names
  - SELECT name FROM artifact_definitions() WHERE name =~ 'Windows.Search.FileFinder'

  # Test the "fs" accessor
  - SELECT OSPath FROM glob(
     globs="/clients/" + CLIENT_ID + "/collections/F.BN2HJCPOF5U7U/uploads/**",
     accessor="fs")

  # Test that we can not overwrite built in artifacts
  - SELECT artifact_set(definition=_value).name
    FROM items(item={
       SELECT * FROM artifact_definitions(names="Generic.Client.Info")
       WHERE name =~ "Generic.Client.Info"
     })

  - SELECT * FROM test_read_logs() WHERE Log =~ "Unable to override built in artifact" LIMIT 1

  # Should be able to set a custom copy of it
  - SELECT artifact_set(definition=patch(
        item=_value, merge=dict(name="Custom.Generic.Client.Info"))).name
    FROM items(item={
       SELECT * FROM artifact_definitions(names="Generic.Client.Info")
       WHERE name =~ "Generic.Client.Info"
     })

  # Set artifact metadata
  - SELECT artifact_set_metadata(name="Custom.Generic.Client.Info", hidden=TRUE)
    FROM scope()

  - SELECT name, metadata FROM artifact_definitions(names="Custom.Generic.Client.Info")

  # Set artifact tags
  - SELECT artifact_set_metadata(name="Custom.Generic.Client.Info", tags=["OneTag"])
    FROM scope()

  - SELECT artifact_set_metadata(name="Custom.Generic.Client.Info", tags="OneTag")
    FROM scope()

  # Single tag list
  - SELECT artifact_set_metadata(name="Custom.Generic.Client.Info", tags=["OneTag",])
    FROM scope()

  - SELECT artifact_set_metadata(name="Custom.Generic.Client.Info", tags=["OneTag", "TwoTags"])
    FROM scope()

  # Clear the tags
  - SELECT artifact_set_metadata(name="Custom.Generic.Client.Info", tags=[])
    FROM scope()
