SELECT Rule, relpath(path=FullPath, base=srcDir, sep="/") as FullPath,Hash,Offset,Xor,DecodedConfig FROM Artifact.Windows.Carving.CobaltStrike(TargetFileGlob=srcDir + "/artifacts/testdata/files/CSDump.bin")[
 {
  "Rule": "cobalt_strike_beacon",
  "FullPath": "artifacts/testdata/files/CSDump.bin",
  "Hash": {
   "MD5": "81d9b0a5308f6e46e06567ef9b889496",
   "SHA1": "ba4a435cff1897ac653b4c6af43c40b4d01c154c",
   "SHA256": "2227d7bd3c7a36a4d1d103e41df9a18798bf0d22b3e6357ee689d320fd318a24"
  },
  "Offset": 0,
  "Xor": "0x2e",
  "DecodedConfig": {
   "BeaconType": "windows-beacon_https-reverse_https",
   "Port": 443,
   "Sleeptime": 60000,
   "Maxgetsize": 1048576,
   "Jitter": 0,
   "MaxDns": 0,
   "PublicKey": "30 81 9f 30 0d 06 09 2a 86 48 86 f7 0d 01 01 01 05 00 03 81 8d 00 30 81 89 02 81 81 00 a7 38 cd e7 5f 1f bb 1c 18 64 6c 37 7e 03 01 6b 16 2b 12 ba 72 bd f7 dc 36 b4 cd 2e 4e 9b ae 12 20 5a 95 c2 61 70 bf 90 81 05 ad 7f a4 bb cc fa 79 86 32 26 1b ed 98 70 f9 75 f2 07 94 e1 fe 49 95 23 d7 1f 08 a5 6c ae 03 15 bf de 3d 6c 8a 16 38 6b 03 b7 a6 55 1a a1 33 6d 50 32 5a 35 00 db 27 d7 8a d8 fd 13 b6 a7 3b 9f b7 c3 fb 4d 7a 08 8e 32 3f 07 61 86 56 ec d8 35 95 fa 5f 82 36 13 02 03 01 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00",
   "C2Server": "137.220.53.51,/dot.gif",
   "UserAgent": "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727)",
   "PostURI": "/submit.php",
   "MalleableC2Instructions": "",
   "HttpGetHeader": "Cookie",
   "HttpPostHeader": "\n\u0026Content-Type: application/octet-streamid",
   "SpawnTo": "",
   "Pipename": "",
   "KillDateYear": 0,
   "KillDateMonth": 0,
   "KillDateDay": 0,
   "DNSIdle": "0.0.0.0",
   "DNSSleep": 0,
   "SSH_1": "",
   "SSH_2": "",
   "SSH_3": "",
   "SSH_4": "",
   "SSH_5": "",
   "GetVerb": "GET",
   "PostVerb": "POST",
   "HttpPostChunk": 0,
   "SpawnTox86": "%windir%\\syswow64\\rundll32.exe",
   "SpawnTox64": "%windir%\\sysnative\\rundll32.exe",
   "CryptoScheme": 0,
   "Proxy": "",
   "ProxyUsername": "",
   "ProxyPassword": "",
   "ProxyType": "IE settings",
   "Deprecated": 0,
   "LicenseId": 305419776,
   "bStageCleanup": 0,
   "bCFGCaution": 0,
   "KillDate": 0,
   "TextSectionEnd": 0,
   "ObfuscateSectionsInfo": "",
   "ProcessInjectStartRWX": "PAGE_EXECUTE_READWRITE",
   "ProcessInjectUseRWX": "PAGE_EXECUTE_READWRITE",
   "ProcessInjectMinAlloc": 0,
   "ProcessInjectTransformx86": "",
   "ProcessInjectTransformx64": "",
   "UsesCookies": 1,
   "ProcessInjectExecute": "",
   "ProcessInjectAllocationMethod": 0,
   "ProcessInjectStub": "b5 4a fe 01 ec 6a 75 ed f3 5e 1a 44 f8 bd 39 29",
   "HostHeader": ""
  }
 },
 {
  "Rule": "cobalt_strike_beacon",
  "FullPath": "artifacts/testdata/files/CSDump.bin",
  "Hash": {
   "MD5": "81d9b0a5308f6e46e06567ef9b889496",
   "SHA1": "ba4a435cff1897ac653b4c6af43c40b4d01c154c",
   "SHA256": "2227d7bd3c7a36a4d1d103e41df9a18798bf0d22b3e6357ee689d320fd318a24"
  },
  "Offset": 11001,
  "Xor": "0x69",
  "DecodedConfig": {
   "BeaconType": "windows-beacon_http-reverse_http",
   "Port": 80,
   "Sleeptime": 60000,
   "Maxgetsize": 1048576,
   "Jitter": 0,
   "MaxDns": 255,
   "PublicKey": "30 81 9f 30 0d 06 09 2a 86 48 86 f7 0d 01 01 01 05 00 03 81 8d 00 30 81 89 02 81 81 00 ea 36 55 7a 8a 85 29 81 8b b7 b8 da 54 2c 24 2b 5a cc 89 83 1b ff ca 4a bc 75 af e9 83 4a f3 26 72 ad 8f 76 74 e3 10 a7 fc 52 46 8f 4a d0 91 59 a6 a3 47 d1 3f 4b 33 a4 36 f2 1a fb 0c f5 e5 f2 5b 5e a5 52 7b 1f bc f8 32 6c 70 2a 0f e9 69 54 29 61 55 9a 6d e9 4a b0 cb 10 99 dd 13 fd 19 50 5d 4b 19 55 21 a8 37 df e2 9c e1 06 0c 91 8f cd 9f 03 c9 d8 17 0c c8 37 d5 18 e5 03 58 a3 03 db 02 03 01 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00",
   "C2Server": "31.44.184.33,/ga.js",
   "UserAgent": "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; NP07; NP07)",
   "PostURI": "/submit.php",
   "MalleableC2Instructions": "",
   "HttpGetHeader": "Cookie",
   "HttpPostHeader": "\n\u0026Content-Type: application/octet-streamid",
   "SpawnTo": "",
   "Pipename": "\\\\%s\\pipe\\msagent_%x",
   "KillDateYear": 0,
   "KillDateMonth": 0,
   "KillDateDay": 0,
   "DNSIdle": "0.0.0.0",
   "DNSSleep": 0,
   "SSH_1": "",
   "SSH_2": "",
   "SSH_3": "",
   "SSH_4": "",
   "SSH_5": "",
   "GetVerb": "",
   "PostVerb": "",
   "HttpPostChunk": 0,
   "SpawnTox86": "%windir%\\syswow64\\rundll32.exe",
   "SpawnTox64": "%windir%\\sysnative\\rundll32.exe",
   "CryptoScheme": 1,
   "Proxy": "",
   "ProxyUsername": "",
   "ProxyPassword": "",
   "ProxyType": "IE settings",
   "Deprecated": 0,
   "LicenseId": 0,
   "bStageCleanup": 0,
   "bCFGCaution": 0,
   "KillDate": 0,
   "TextSectionEnd": 0,
   "ObfuscateSectionsInfo": "",
   "ProcessInjectStartRWX": "PAGE_EXECUTE_READWRITE",
   "ProcessInjectUseRWX": "PAGE_EXECUTE_READWRITE",
   "ProcessInjectMinAlloc": 0,
   "ProcessInjectTransformx86": "",
   "ProcessInjectTransformx64": "",
   "UsesCookies": 0,
   "ProcessInjectExecute": "",
   "ProcessInjectAllocationMethod": 0,
   "ProcessInjectStub": "",
   "HostHeader": ""
  }
 }
]LET Encoded = SELECT Data FROM read_file(filenames=srcDir + "/artifacts/testdata/files/CSDump.bin")[]SELECT Rule,Hash,Offset,Xor,DecodedConfig,DecodedData FROM Artifact.Windows.Carving.CobaltStrike(TargetBytes=Encoded.Data[0],BruteXor="T", IncludeDecodedData="Y")[]SELECT Rule, relpath(path=FullPath, base=srcDir, sep="/") as FullPath,Hash,Offset,Xor,DecodedConfig FROM Artifact.Windows.Carving.CobaltStrike(TargetFileGlob=srcDir + "/artifacts/testdata/files/CSShellcode.bin")[
 {
  "Rule": "cobalt_strike_shellcode",
  "FullPath": "artifacts/testdata/files/CSShellcode.bin",
  "Hash": {
   "MD5": "b173bd1934797444b0f8658495ab0765",
   "SHA1": "75082bb8c6c3529a298b5e3432a2769362efe451",
   "SHA256": "771e8bef3711e8327b5ddb9c6109bd23e494488cccd31097e91033a427e413ef"
  },
  "Offset": 0,
  "Xor": "0x00",
  "DecodedConfig": {
   "Server": "10.8.0.58",
   "TargetUri": "/pi9K",
   "Licence": 426352781,
   "Strings": [
    "AQAPRQVH1",
    "AXAX^YZAXAYAZH",
    "XAYZH",
    "wininet",
    "APAPA",
    "AQAQj",
    "/pi9K",
    "User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; BOIE9;ENUSMSE)",
    "PMD?!Y",
    "10.8.0.58"
   ]
  }
 }
]