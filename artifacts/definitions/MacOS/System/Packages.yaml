name: MacOS.System.Packages
description: Parse packages installed on Macs

parameters:
  - name: command 
    default: system_profiler -json SPApplicationsDataType
sources:
  - precondition: |
      SELECT OS From info() where OS = 'darwin'
    queries:
      - |
        LET packages = SELECT * FROM execve(argv=["/bin/bash", "-c", command])

        LET packages_parsed = SELECT SPApplicationsDataType as Packages FROM foreach(row=parse_json_array(data=packages.Stdout))
        
        SELECT * FROM foreach(row=packages_parsed.Packages[0])
        
        